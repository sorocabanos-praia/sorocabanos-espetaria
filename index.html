<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CardÃ¡pio Sorocabanos</title>
    <style>
        /* [MANTENHA TODOS OS ESTILOS CSS ORIGINAIS] */
        /* Os estilos permanecem exatamente iguais ao seu cÃ³digo original */
    </style>
</head>
<body>
    <div class="cardapio-container">
        <div class="background-image" style="background: linear-gradient(135deg, #D35400, #E67E22);">
            <img src="img/bg-sites.png" alt="Background Sorocabanos" class="background-image">
        </div>

        <div class="content">
            <div class="header">
                <!-- Logo serÃ¡ carregada via background-image no CSS -->
            </div>

            <div class="menu-items">
                <!-- Tocino del Diablo -->
                <div class="menu-item">
                    <div class="item-image">
                        <img src="img/pnct.png" alt="Tocino del Diablo - Panceta" class="img-espeto">
                    </div>
                    <div class="item-content">
                        <div class="item-header">
                            <h3 class="item-name">TOCINO DEL DIABLO</h3>
                            <span class="item-price">R$ 13,00</span>
                        </div>
                        <p class="item-description">Panceta curada e grelhada com tempero secreto mexicano. Crocante, suculento e ousado!</p>
                        <span class="badge badge-spicy">ACOMPANHAMENTO</span>
                        <div class="cart-controls">
                            <div class="quantity-controls">
                                <button class="quantity-btn minus" data-item="TOCINO DEL DIABLO">-</button>
                                <span class="quantity-display" data-item="TOCINO DEL DIABLO">0</span>
                                <button class="quantity-btn plus" data-item="TOCINO DEL DIABLO">+</button>
                            </div>
                            <button class="add-to-cart-btn" data-item="TOCINO DEL DIABLO" data-price="13.00">Adicionar</button>
                        </div>
                    </div>
                </div>

                <!-- Adicione mais itens do cardÃ¡pio aqui seguindo o mesmo padrÃ£o -->
                
            </div>

            <div class="footer">
                <p class="footer-text">ðŸŒ® Cada espeto Ã© uma celebraÃ§Ã£o de sabores! ðŸŒ®</p>
                <p class="contact">@sorocabanos_espetaria â€¢ (15) 98831-1590</p>
            </div>
        </div>
    </div>

    <!-- Ãcone do carrinho -->
    <div class="cart-icon">
        ðŸ›’
        <span class="cart-count">0</span>
    </div>

    <!-- Carrinho de compras -->
    <div class="cart-container">
        <div class="cart-header">
            <h3 class="cart-title">Seu Pedido</h3>
            <button class="close-cart">Ã—</button>
        </div>
        <div class="cart-items">
            <!-- Itens do carrinho serÃ£o inseridos aqui dinamicamente -->
        </div>
        <div class="cart-total">
            Total: R$ <span class="total-value">0,00</span>
        </div>
        <button class="checkout-btn">Finalizar Pedido</button>
    </div>

    <!-- Modal para informaÃ§Ãµes do cliente -->
    <div class="modal" id="customerModal">
        <div class="modal-content">
            <h3 class="modal-title">InformaÃ§Ãµes para Entrega</h3>
            <div class="form-group">
                <label for="customerName">Nome *</label>
                <input type="text" id="customerName" placeholder="Seu nome completo" required>
            </div>
            <div class="form-group">
                <label for="customerPhone">Telefone *</label>
                <input type="tel" id="customerPhone" placeholder="(15) 98831-1590" required>
            </div>
            <div class="form-group">
                <label for="customerAddress">EndereÃ§o *</label>
                <input type="text" id="customerAddress" placeholder="EndereÃ§o completo para entrega" required>
            </div>
            <div class="modal-buttons">
                <button class="modal-btn cancel-btn" id="cancelOrder">Cancelar</button>
                <button class="modal-btn submit-btn" id="submitOrder">Enviar Pedido</button>
            </div>
        </div>
    </div>

    <script>
        // Estado do carrinho
        let cart = {};
        let cartTotal = 0;

        // Elementos do DOM
        const cartIcon = document.querySelector('.cart-icon');
        const cartContainer = document.querySelector('.cart-container');
        const closeCartBtn = document.querySelector('.close-cart');
        const cartItemsContainer = document.querySelector('.cart-items');
        const totalValueElement = document.querySelector('.total-value');
        const cartCountElement = document.querySelector('.cart-count');
        const checkoutBtn = document.querySelector('.checkout-btn');
        const customerModal = document.getElementById('customerModal');
        const cancelOrderBtn = document.getElementById('cancelOrder');
        const submitOrderBtn = document.getElementById('submitOrder');

        // FunÃ§Ãµes do carrinho
        function updateCartDisplay() {
            const totalItems = Object.values(cart).reduce((sum, item) => sum + item.quantity, 0);
            cartCountElement.textContent = totalItems;

            cartItemsContainer.innerHTML = '';
            cartTotal = 0;

            Object.keys(cart).forEach(itemName => {
                const item = cart[itemName];
                const itemTotal = item.price * item.quantity;
                cartTotal += itemTotal;

                const cartItemElement = document.createElement('div');
                cartItemElement.className = 'cart-item';
                cartItemElement.innerHTML = `
                    <div class="cart-item-info">
                        <div class="cart-item-name">${itemName}</div>
                        <div class="cart-item-price">R$ ${item.price.toFixed(2)}</div>
                    </div>
                    <div class="cart-item-quantity">
                        <button class="quantity-btn minus" data-item="${itemName}">-</button>
                        <span>${item.quantity}</span>
                        <button class="quantity-btn plus" data-item="${itemName}">+</button>
                    </div>
                `;
                cartItemsContainer.appendChild(cartItemElement);
            });

            totalValueElement.textContent = cartTotal.toFixed(2).replace('.', ',');
        }

        function addToCart(itemName, price) {
            if (cart[itemName]) {
                cart[itemName].quantity += 1;
            } else {
                cart[itemName] = {
                    price: parseFloat(price),
                    quantity: 1
                };
            }
            updateCartDisplay();
            resetQuantityDisplay(itemName);
        }

        function removeFromCart(itemName) {
            if (cart[itemName]) {
                cart[itemName].quantity -= 1;
                if (cart[itemName].quantity <= 0) {
                    delete cart[itemName];
                }
            }
            updateCartDisplay();
            resetQuantityDisplay(itemName);
        }

        function resetQuantityDisplay(itemName) {
            const quantityDisplay = document.querySelector(`.quantity-display[data-item="${itemName}"]`);
            if (quantityDisplay) {
                quantityDisplay.textContent = '0';
            }
        }

       // FunÃ§Ã£o para enviar pedido para o Notion via Netlify Function
async function sendOrderToNotion(name, phone, address) {
    const mensagem = document.getElementById('mensagem') || createMessageElement();
    
    try {
        // Formatar itens do pedido
        const orderItems = Object.keys(cart).map(itemName => {
            const item = cart[itemName];
            return `${itemName} (${item.quantity}x) - R$ ${(item.price * item.quantity).toFixed(2)}`;
        }).join('\n');

        // Dados para enviar ao Notion (CORRIGIDO)
        const orderData = {
            nome: name,
            telefone: phone,
            endereco: address,
            itens: orderItems,
            total: cartTotal.toFixed(2) // JÃ¡ formatado como string
        };

        console.log('Enviando para Netlify Function:', orderData);

        // Enviar para Netlify Function (CORRIGIR URL)
        const resposta = await fetch('/.netlify/functions/enviarParaNotion', { // âš¡ CORREÃ‡ÃƒO AQUI!
            method: 'POST',
            headers: { 
                'Content-Type': 'application/json' 
            },
            body: JSON.stringify(orderData),
        });

        const data = await resposta.json();

        if (resposta.ok) {
            showMessage('âœ… Pedido enviado com sucesso! Em breve entraremos em contato.', 'success');
            
            // Limpar carrinho e formulÃ¡rio
            cart = {};
            updateCartDisplay();
            customerModal.style.display = 'none';
            
            document.getElementById('customerName').value = '';
            document.getElementById('customerPhone').value = '';
            document.getElementById('customerAddress').value = '';
        } else {
            throw new Error(data.error || 'Erro ao enviar pedido');
        }
    } catch (error) {
        console.error('Erro:', error);
        showMessage('âŒ Erro ao enviar pedido. Tente novamente ou entre em contato diretamente.', 'error');
    }
}

        function showMessage(text, type) {
            let messageElement = document.getElementById('mensagem');
            if (!messageElement) {
                messageElement = document.createElement('div');
                messageElement.id = 'mensagem';
                messageElement.style.cssText = `
                    position: fixed;
                    top: 20px;
                    left: 50%;
                    transform: translateX(-50%);
                    padding: 15px 25px;
                    border-radius: 10px;
                    font-weight: bold;
                    z-index: 3000;
                    text-align: center;
                    min-width: 300px;
                `;
                document.body.appendChild(messageElement);
            }

            messageElement.textContent = text;
            messageElement.style.background = type === 'success' ? '#27AE60' : '#E74C3C';
            messageElement.style.color = 'white';

            setTimeout(() => {
                messageElement.remove();
            }, 5000);
        }

        function createMessageElement() {
            const element = document.createElement('div');
            element.id = 'mensagem';
            document.body.appendChild(element);
            return element;
        }

        // Event Listeners
        document.addEventListener('DOMContentLoaded', function() {
            // BotÃµes de quantidade
            document.querySelectorAll('.quantity-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const itemName = this.getAttribute('data-item');
                    const quantityDisplay = document.querySelector(`.quantity-display[data-item="${itemName}"]`);
                    let quantity = parseInt(quantityDisplay.textContent);

                    if (this.classList.contains('plus')) {
                        quantity++;
                    } else if (this.classList.contains('minus') && quantity > 0) {
                        quantity--;
                    }

                    quantityDisplay.textContent = quantity;
                });
            });

            // BotÃµes de adicionar ao carrinho
            document.querySelectorAll('.add-to-cart-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const itemName = this.getAttribute('data-item');
                    const price = this.getAttribute('data-price');
                    const quantityDisplay = document.querySelector(`.quantity-display[data-item="${itemName}"]`);
                    const quantity = parseInt(quantityDisplay.textContent);

                    if (quantity > 0) {
                        for (let i = 0; i < quantity; i++) {
                            addToCart(itemName, price);
                        }
                        showMessage(`âœ… ${quantity}x ${itemName} adicionado(s) ao carrinho!`, 'success');
                    } else {
                        showMessage('âŒ Selecione uma quantidade primeiro!', 'error');
                    }
                });
            });

            // Ãcone do carrinho
            cartIcon.addEventListener('click', function() {
                cartContainer.style.display = 'block';
            });

            // Fechar carrinho
            closeCartBtn.addEventListener('click', function() {
                cartContainer.style.display = 'none';
            });

            // Finalizar pedido
            checkoutBtn.addEventListener('click', function() {
                if (Object.keys(cart).length === 0) {
                    showMessage('âŒ Seu carrinho estÃ¡ vazio!', 'error');
                    return;
                }
                customerModal.style.display = 'flex';
            });

            // Cancelar pedido
            cancelOrderBtn.addEventListener('click', function() {
                customerModal.style.display = 'none';
            });

            // Enviar pedido
            submitOrderBtn.addEventListener('click', function() {
                const customerName = document.getElementById('customerName').value.trim();
                const customerPhone = document.getElementById('customerPhone').value.trim();
                const customerAddress = document.getElementById('customerAddress').value.trim();

                if (!customerName || !customerPhone || !customerAddress) {
                    showMessage('âŒ Por favor, preencha todas as informaÃ§Ãµes!', 'error');
                    return;
                }

                // Validar telefone (formato simples)
                const phoneRegex = /^[\d\s\(\)\-]+$/;
                if (!phoneRegex.test(customerPhone)) {
                    showMessage('âŒ Por favor, insira um telefone vÃ¡lido!', 'error');
                    return;
                }

                sendOrderToNotion(customerName, customerPhone, customerAddress);
            });

            // Delegar eventos para botÃµes de quantidade no carrinho
            cartItemsContainer.addEventListener('click', function(e) {
                if (e.target.classList.contains('quantity-btn')) {
                    const itemName = e.target.getAttribute('data-item');
                    if (e.target.classList.contains('plus')) {
                        addToCart(itemName, cart[itemName].price);
                    } else if (e.target.classList.contains('minus')) {
                        removeFromCart(itemName);
                    }
                }
            });

            // Fechar modal clicando fora
            customerModal.addEventListener('click', function(e) {
                if (e.target === customerModal) {
                    customerModal.style.display = 'none';
                }
            });
        });
    </script>
</body>
</html>
